<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Computing Curriculum Quest (KS3‚ÄìKS5)</title>
  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card:#0F1630;
      --card2:#0D1430;
      --text:#EAF0FF;
      --muted:#AAB7E6;

      --cs:#7C4DFF;      /* purple */
      --ict:#00E5FF;     /* cyan */
      --dl:#FF4D8D;      /* pink */

      --ks3:#7CFF6B;     /* green */
      --ks4:#FFD24D;     /* amber */
      --ks5:#4DA3FF;     /* blue */

      --good:#36D399;
      --warn:#FBBF24;
      --bad:#FB7185;

      --ring: 0 0 0 3px rgba(124,77,255,.35);
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(124,77,255,.18), transparent 60%),
        radial-gradient(1000px 600px at 80% 20%, rgba(0,229,255,.14), transparent 55%),
        radial-gradient(1000px 800px at 60% 90%, rgba(255,77,141,.12), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    a{color:inherit}
    button{
      appearance:none;
      border:none;
      cursor:pointer;
      color:inherit;
      font:inherit;
      background:none;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    header:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 180px at 10% 0%, rgba(124,77,255,.28), transparent 70%),
        radial-gradient(600px 180px at 70% 0%, rgba(0,229,255,.22), transparent 70%),
        radial-gradient(600px 180px at 95% 0%, rgba(255,77,141,.20), transparent 70%);
      pointer-events:none;
      opacity:.85;
    }
    .h-left{position:relative; z-index:1}
    .title{
      margin:0;
      font-size: clamp(20px, 2.8vw, 34px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      line-height:1.35;
      max-width: 62ch;
    }

    .pills{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      position:relative;
      z-index:1;
      min-width: 240px;
    }
    .pill{
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,22,48,.45);
      display:flex;
      align-items:center;
      gap:8px;
      backdrop-filter: blur(8px);
    }
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .dot.cs{background:var(--cs)}
    .dot.ict{background:var(--ict)}
    .dot.dl{background:var(--dl)}
    .dot.ks3{background:var(--ks3)}
    .dot.ks4{background:var(--ks4)}
    .dot.ks5{background:var(--ks5)}

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
      .pills{justify-content:flex-start}
    }

    .panel{
      background: rgba(15,22,48,.58);
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .panelHead{
      padding:14px 16px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .panelHead h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size:12px;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
      background: rgba(0,0,0,.18);
    }

    .panelBody{padding:14px 16px 16px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .btn{
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,16,36,.35);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.20)}
    .btn:active{transform: translateY(0px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,77,255,.20), rgba(0,229,255,.14));
      border-color: rgba(124,77,255,.35);
    }
    .btn.warn{
      background: linear-gradient(135deg, rgba(251,191,36,.18), rgba(255,77,141,.10));
      border-color: rgba(251,191,36,.35);
    }
    .btn.good{
      background: linear-gradient(135deg, rgba(54,211,153,.18), rgba(0,229,255,.10));
      border-color: rgba(54,211,153,.35);
    }
    .btn.ghost{
      background: rgba(0,0,0,.18);
      border-color: rgba(255,255,255,.10);
    }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      transform:none;
    }

    .kbd{
      font-size:11px;
      padding:2px 7px;
      border-radius: 8px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: var(--muted);
    }

    .status{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .stat{
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .stat .label{color:var(--muted); font-size:12px}
    .stat .value{font-size:18px; font-weight:700; letter-spacing:.2px}
    .stat .hint{color:var(--muted); font-size:12px; margin-top:2px}

    .toast{
      margin-top:12px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: var(--muted);
      line-height:1.35;
    }

    /* Game area */
    .gameTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .modePills{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .mode{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size:12px;
      color: var(--muted);
    }
    .mode.active{
      color:var(--text);
      border-color: rgba(255,255,255,.22);
      box-shadow: var(--ring);
    }

    .cardStack{
      display:grid;
      gap:12px;
    }

    .prompt{
      padding:14px 14px;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      position:relative;
      overflow:hidden;
    }
    .prompt:before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(600px 200px at 10% 0%, rgba(124,77,255,.20), transparent 60%),
        radial-gradient(500px 200px at 70% 0%, rgba(0,229,255,.14), transparent 65%),
        radial-gradient(600px 220px at 95% 0%, rgba(255,77,141,.12), transparent 70%);
      opacity:.9;
      pointer-events:none;
    }
    .promptInner{position:relative; z-index:1}
    .promptTitle{
      margin:0 0 8px;
      font-size:14px;
      color: var(--muted);
      letter-spacing:.15px;
    }
    .promptText{
      margin:0;
      font-size:18px;
      font-weight:700;
      letter-spacing:.2px;
      line-height:1.25;
    }
    .mini{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .choices{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 560px){ .choices{grid-template-columns:1fr} }

    .choice{
      text-align:left;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,22,48,.38);
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
      min-height: 52px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .choice:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .choice:focus-visible{outline:none; box-shadow: var(--ring)}
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:5px 9px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      white-space:nowrap;
    }
    .tag strong{color:var(--text); font-weight:700}
    .tag.cs{border-color: rgba(124,77,255,.35)}
    .tag.ict{border-color: rgba(0,229,255,.35)}
    .tag.dl{border-color: rgba(255,77,141,.35)}
    .tag.ks3{border-color: rgba(124,255,107,.35)}
    .tag.ks4{border-color: rgba(255,210,77,.35)}
    .tag.ks5{border-color: rgba(77,163,255,.35)}

    .feedback{
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      margin-top: 12px;
      display:none;
      line-height:1.35;
    }
    .feedback.good{border-color: rgba(54,211,153,.45)}
    .feedback.bad{border-color: rgba(251,113,133,.50)}
    .feedback .big{font-weight:800; font-size:14px}
    .feedback .small{color:var(--muted); font-size:12px; margin-top:6px}

    .progressWrap{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top: 12px;
    }
    .bar{
      flex:1;
      height: 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(124,77,255,.9), rgba(0,229,255,.85), rgba(255,77,141,.85));
      border-radius:999px;
      transition: width .25s ease;
    }
    .barMeta{font-size:12px; color: var(--muted); min-width: 88px; text-align:right}

    .asideList{
      display:grid;
      gap:10px;
    }
    .tip{
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      line-height:1.35;
    }
    .tip h3{
      margin:0 0 6px;
      font-size:13px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .tip p{margin:0; color: var(--muted); font-size:12px}
    .hr{height:1px; background: rgba(255,255,255,.08); margin:12px 0}

    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;overflow:hidden;
      clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }

    /* Confetti canvas */
    #fx{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 50;
    }

    /* ===== Video Briefing (NEW) ===== */
    .briefing{
      padding:12px 12px;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      margin-bottom: 12px;
      overflow:hidden;
    }
    .briefHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .briefHead h3{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .briefMeta{
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
      margin:0 0 10px;
    }
    .videoFrame{
      position:relative;
      width:100%;
      padding-top:56.25%; /* 16:9 */
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,22,48,.35);
    }
    .videoFrame iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
    }
    .clipRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 10px;
      align-items:center;
    }
    .checkRow{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .checkRow label{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size:12px;
      user-select:none;
    }
    .checkRow input{
      width:18px;
      height:18px;
      accent-color: #7C4DFF;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important; scroll-behavior:auto !important}
    }
  </style>
</head>

<body>
<canvas id="fx" aria-hidden="true"></canvas>

<div class="wrap">
  <header>
    <div class="h-left">
      <h1 class="title">Computing Curriculum Quest</h1>
      <p class="subtitle">
        Fast, ADHD-friendly micro-rounds to learn how topics fit across <strong>KS3</strong>, <strong>KS4</strong>, and <strong>KS5</strong>,
        and how they split into <strong>Computer Science</strong>, <strong>ICT</strong>, and <strong>Digital Literacy</strong>.
      </p>
    </div>
    <div class="pills" aria-label="Legend">
      <div class="pill"><span class="dot cs"></span> Computer Science</div>
      <div class="pill"><span class="dot ict"></span> ICT</div>
      <div class="pill"><span class="dot dl"></span> Digital Literacy</div>
      <div class="pill"><span class="dot ks3"></span> KS3</div>
      <div class="pill"><span class="dot ks4"></span> KS4</div>
      <div class="pill"><span class="dot ks5"></span> KS5</div>
    </div>
  </header>

  <div class="grid">
    <!-- Main game -->
    <section class="panel" aria-labelledby="gameTitle">
      <div class="panelHead">
        <h2 id="gameTitle">Game</h2>
        <div class="row">
          <button class="btn primary" id="btnNext" title="Next card (Enter)">
            ‚ñ∂ Next <span class="kbd">Enter</span>
          </button>
          <button class="btn" id="btnSkip" title="Skip (S)">
            Skip <span class="kbd">S</span>
          </button>
          <button class="btn warn" id="btnReset" title="Reset progress">
            Reset
          </button>
        </div>
      </div>

      <div class="panelBody">
        <!-- ===== Video Briefing (NEW) ===== -->
        <div class="briefing" id="briefing" aria-label="Video briefing">
          <div class="briefHead">
            <h3>üé¨ Briefing video (watch a key bit, then quiz)</h3>
            <div class="row">
              <button class="btn ghost" id="btnHideBrief" title="Hide/show briefing">Hide</button>
              <button class="btn good" id="btnStartQuiz" disabled title="Enable by ticking 'I've watched' (or skip)">
                Start Quiz
              </button>
              <button class="btn" id="btnSkipBrief" title="Skip briefing and start quiz">
                Skip briefing
              </button>
            </div>
          </div>
          <p class="briefMeta">
            Pick a short clip, grab the ‚Äúbig idea‚Äù, then jump into the micro-round. (You can always come back.)
          </p>

          <div class="videoFrame">
            <iframe
              id="yt"
              title="Curriculum briefing video"
              loading="lazy"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen
            ></iframe>
          </div>

          <div class="clipRow" aria-label="Key clips">
            <button class="btn primary" data-start="0"   id="clip0">‚ñ∂ Intro</button>
            <button class="btn"         data-start="30"  id="clip1">KS3 foundations</button>
            <button class="btn"         data-start="75"  id="clip2">KS4 GCSE depth</button>
            <button class="btn"         data-start="125" id="clip3">KS5 pathways</button>
            <button class="btn warn"    data-start="170" id="clip4">Strands: CS vs ICT vs DL</button>
          </div>

          <div class="checkRow">
            <label>
              <input type="checkbox" id="watchedCheck" />
              I‚Äôve watched enough to try the quiz
            </label>
            <span class="badge" id="briefHint">Tip: pick one clip only (30‚Äì60s). Don‚Äôt binge.</span>
          </div>
        </div>

        <div class="gameTop" id="gameTop">
          <div class="modePills" role="tablist" aria-label="Game mode">
            <button class="mode active" data-mode="strand" role="tab" aria-selected="true">Mode: Strand</button>
            <button class="mode" data-mode="keystage" role="tab" aria-selected="false">Mode: Key Stage</button>
            <button class="mode" data-mode="both" role="tab" aria-selected="false">Mode: Both (Boss)</button>
          </div>

          <div class="row" aria-label="Quick settings">
            <button class="btn good" id="btnFocus" title="Toggle Focus Mode: fewer distractions">
              Focus Mode
            </button>
            <span class="badge" id="difficultyBadge">Short rounds ‚Ä¢ 60‚Äì90s</span>
          </div>
        </div>

        <div class="cardStack">
          <div class="prompt" aria-live="polite">
            <div class="promptInner">
              <div class="promptTitle" id="promptTitle">Sort this topic</div>
              <p class="promptText" id="promptText">Loading‚Ä¶</p>
              <div class="mini" id="promptMini">
                Tip: quick guesses are fine ‚Äî repetition is the point.
              </div>
            </div>
          </div>

          <div class="choices" id="choices" aria-label="Answer choices">
            <!-- injected -->
          </div>

          <div class="feedback" id="feedback" role="status" aria-live="polite"></div>

          <div class="progressWrap" aria-label="Round progress">
            <div class="bar"><i id="barFill"></i></div>
            <div class="barMeta"><span id="barMeta">0 / 12</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Side panel -->
    <aside class="panel" aria-labelledby="coachTitle">
      <div class="panelHead">
        <h2 id="coachTitle">Coach + Score</h2>
        <span class="badge" id="streakBadge">Streak: 0</span>
      </div>
      <div class="panelBody">
        <div class="status" aria-label="Scoreboard">
          <div class="stat">
            <div class="label">Score</div>
            <div class="value" id="score">0</div>
            <div class="hint">+10 correct</div>
          </div>
          <div class="stat">
            <div class="label">Accuracy</div>
            <div class="value" id="acc">0%</div>
            <div class="hint">Aim: 80%+</div>
          </div>
          <div class="stat">
            <div class="label">Cards left</div>
            <div class="value" id="left">12</div>
            <div class="hint">Quick wins</div>
          </div>
        </div>

        <div class="toast" id="toast">
          <strong>How to play:</strong> pick the best match. If you‚Äôre wrong, you‚Äôll see the correct mapping and a one-line reason.
          Use <span class="kbd">1</span> <span class="kbd">2</span> <span class="kbd">3</span> (and <span class="kbd">4</span> <span class="kbd">5</span> <span class="kbd">6</span> in Boss mode).
        </div>

        <div class="hr"></div>

        <div class="asideList">
          <div class="tip">
            <h3>‚ö° ADHD-friendly design</h3>
            <p>Micro-rounds, instant feedback, streaks, and ‚Äúgood enough‚Äù guessing. Repetition builds the schema.</p>
          </div>

          <div class="tip">
            <h3>üß† Strand cheat sheet</h3>
            <p>
              <span class="tag cs"><strong>CS</strong> algorithms ‚Ä¢ programming ‚Ä¢ systems ‚Ä¢ networks ‚Ä¢ data representation</span><br><br>
              <span class="tag ict"><strong>ICT</strong> using tools ‚Ä¢ data handling ‚Ä¢ media ‚Ä¢ productivity ‚Ä¢ applied projects</span><br><br>
              <span class="tag dl"><strong>DL</strong> online safety ‚Ä¢ identity ‚Ä¢ ethics ‚Ä¢ credibility ‚Ä¢ responsible use</span>
            </p>
          </div>

          <div class="tip">
            <h3>üéØ Key stage cheat sheet</h3>
            <p>
              <span class="tag ks3"><strong>KS3</strong> foundations + first programming</span><br><br>
              <span class="tag ks4"><strong>KS4</strong> GCSE depth (CPU/networks/security + robust coding)</span><br><br>
              <span class="tag ks5"><strong>KS5</strong> A-level / vocational specialism (DSA, theory, NEA)</span>
            </p>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <p class="subtitle" style="margin:16px 6px 0;">
    Accessibility: keyboard shortcuts, reduced motion support, and Focus Mode. Works offline as a single HTML file.
  </p>
</div>

<script>
/* ===========================
   Curriculum Card Dataset
   =========================== */

const STRANDS = [
  { key:"cs",  label:"Computer Science", color:"var(--cs)" },
  { key:"ict", label:"ICT",              color:"var(--ict)" },
  { key:"dl",  label:"Digital Literacy", color:"var(--dl)" }
];

const KEYSTAGES = [
  { key:"ks3", label:"KS3", color:"var(--ks3)" },
  { key:"ks4", label:"KS4", color:"var(--ks4)" },
  { key:"ks5", label:"KS5", color:"var(--ks5)" }
];

const CARDS = [
  // KS3 CS
  { topic:"Variables, selection, iteration", strand:"cs", ks:"ks3", why:"Core programming constructs introduced at KS3." },
  { topic:"Decomposition + debugging", strand:"cs", ks:"ks3", why:"Computational thinking and code improvement skills at KS3." },
  { topic:"Data representation (binary basics)", strand:"cs", ks:"ks3", why:"Students learn how data can be represented in binary." },
  { topic:"Hardware vs software", strand:"cs", ks:"ks3", why:"Foundational systems knowledge before GCSE depth." },
  { topic:"Networks basics + security awareness", strand:"cs", ks:"ks3", why:"Intro networking and security concepts at KS3." },

  // KS3 ICT / DL
  { topic:"Creating digital artefacts with tools (media/data)", strand:"ict", ks:"ks3", why:"Using software tools to produce and refine outcomes." },
  { topic:"Online safety + privacy settings", strand:"dl", ks:"ks3", why:"Responsible, safe participation is explicit at KS3." },
  { topic:"Credibility of online information", strand:"dl", ks:"ks3", why:"Digital literacy: evaluating sources and misinformation." },

  // KS4 GCSE CS
  { topic:"CPU, memory, storage (GCSE depth)", strand:"cs", ks:"ks4", why:"Core GCSE computer systems content." },
  { topic:"Networks + protocols + cybersecurity", strand:"cs", ks:"ks4", why:"GCSE builds on KS3 networking with greater detail." },
  { topic:"Programming: robust solutions + testing", strand:"cs", ks:"ks4", why:"GCSE requires more complex programs + systematic testing." },

  // KS5 CS / ICT / DL
  { topic:"Data structures + algorithms (complexity)", strand:"cs", ks:"ks5", why:"A-level expects DSA and complexity thinking." },
  { topic:"Theory of computation (FSM/regular languages)", strand:"cs", ks:"ks5", why:"Formal CS theory is typically post-16." },
  { topic:"NEA / extended programming project", strand:"cs", ks:"ks5", why:"Large independent project is a key KS5 feature." },
  { topic:"Applied industry tools (technical routes)", strand:"ict", ks:"ks5", why:"Post-16 vocational paths emphasise professional tooling." },
  { topic:"Workplace digital habits + communication", strand:"dl", ks:"ks5", why:"Digital professionalism: safe, ethical, effective practice." }
];

const ROUND_SIZE = 12;

/* ===========================
   State
   =========================== */
const state = {
  mode: "strand", // strand | keystage | both
  focus: false,
  deck: [],
  idx: 0,
  score: 0,
  correct: 0,
  total: 0,
  streak: 0,
  bestStreak: 0,
  locked: false
};

/* ===========================
   DOM
   =========================== */
const el = (id) => document.getElementById(id);
const promptTitle = el("promptTitle");
const promptText  = el("promptText");
const promptMini  = el("promptMini");
const choicesWrap = el("choices");
const feedback    = el("feedback");
const barFill     = el("barFill");
const barMeta     = el("barMeta");

const scoreEl = el("score");
const accEl   = el("acc");
const leftEl  = el("left");
const streakBadge = el("streakBadge");
const difficultyBadge = el("difficultyBadge");

const btnNext  = el("btnNext");
const btnSkip  = el("btnSkip");
const btnReset = el("btnReset");
const btnFocus = el("btnFocus");

const modes = Array.from(document.querySelectorAll(".mode"));

/* ===========================
   Video briefing (NEW)
   =========================== */
const VIDEO_ID = "jCm0UfZY6do"; // from https://youtu.be/jCm0UfZY6do
const yt = el("yt");
const briefing = el("briefing");
const btnStartQuiz = el("btnStartQuiz");
const btnSkipBrief = el("btnSkipBrief");
const btnHideBrief = el("btnHideBrief");
const watchedCheck = el("watchedCheck");

// Use privacy-enhanced embed
function setVideoStart(seconds){
  const start = Math.max(0, Number(seconds || 0));
  yt.src = `https://www.youtube-nocookie.com/embed/${VIDEO_ID}?start=${start}&rel=0&modestbranding=1`;
}

// initial load at start
setVideoStart(0);

// clip buttons
document.querySelectorAll("[data-start]").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const s = btn.getAttribute("data-start");
    setVideoStart(s);
    // soft nudge: focus the iframe region
    briefing.scrollIntoView({behavior:"smooth", block:"start"});
  });
});

watchedCheck.addEventListener("change", ()=>{
  btnStartQuiz.disabled = !watchedCheck.checked;
});

btnSkipBrief.addEventListener("click", ()=>{
  // allow immediate start without checkbox
  btnStartQuiz.disabled = false;
  watchedCheck.checked = true;
  scrollToQuiz();
});

btnStartQuiz.addEventListener("click", ()=>{
  scrollToQuiz();
});

let briefingHidden = false;
btnHideBrief.addEventListener("click", ()=>{
  briefingHidden = !briefingHidden;
  if(briefingHidden){
    // collapse: keep header controls visible by shrinking to just the head
    // simplest: toggle display of everything except the head
    Array.from(briefing.children).forEach((child, idx)=>{
      if(idx === 0) return; // keep header row
      child.style.display = "none";
    });
    btnHideBrief.textContent = "Show";
  } else {
    Array.from(briefing.children).forEach((child, idx)=>{
      if(idx === 0) return;
      child.style.display = "";
    });
    btnHideBrief.textContent = "Hide";
  }
});

function scrollToQuiz(){
  // scroll to the prompt card
  const target = document.querySelector(".prompt");
  if(target){
    target.scrollIntoView({behavior:"smooth", block:"start"});
  }
}

/* ===========================
   Utility
   =========================== */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function pct(n,d){ return d===0 ? 0 : Math.round((n/d)*100); }

function tagHTML(kind, key){
  const map = { cs:"cs", ict:"ict", dl:"dl", ks3:"ks3", ks4:"ks4", ks5:"ks5" };
  const klass = map[key] || "";
  const label = (
    STRANDS.find(s=>s.key===key)?.label ||
    KEYSTAGES.find(k=>k.key===key)?.label ||
    key
  );
  return `<span class="tag ${klass}"><strong>${label}</strong></span>`;
}

function setFeedback(type, html){
  feedback.className = `feedback ${type}`;
  feedback.innerHTML = html;
  feedback.style.display = "block";
}

function clearFeedback(){
  feedback.style.display = "none";
  feedback.innerHTML = "";
}

/* ===========================
   Build a short round deck
   =========================== */
function buildDeck(){
  return shuffle(CARDS).slice(0, ROUND_SIZE);
}

/* ===========================
   Render
   =========================== */
function updateStats(){
  scoreEl.textContent = state.score;
  accEl.textContent = `${pct(state.correct, state.total)}%`;
  const remaining = Math.max(0, state.deck.length - state.idx);
  leftEl.textContent = remaining;
  streakBadge.textContent = `Streak: ${state.streak} (Best ${state.bestStreak})`;

  const done = state.idx;
  const total = state.deck.length;
  barFill.style.width = `${total ? (done/total)*100 : 0}%`;
  barMeta.textContent = `${done} / ${total}`;
}

function renderMode(){
  modes.forEach(b=>{
    const active = (b.dataset.mode === state.mode);
    b.classList.toggle("active", active);
    b.setAttribute("aria-selected", active ? "true" : "false");
  });

  if(state.mode === "strand"){
    difficultyBadge.textContent = "Strand mode ‚Ä¢ quick wins";
    promptTitle.textContent = "Which strand does this fit best?";
  } else if(state.mode === "keystage"){
    difficultyBadge.textContent = "Key Stage mode ‚Ä¢ progress map";
    promptTitle.textContent = "Which key stage fits best?";
  } else {
    difficultyBadge.textContent = "Boss mode ‚Ä¢ strand + key stage";
    promptTitle.textContent = "Boss mode: pick the best combo";
  }

  renderCard();
}

function renderChoices(card){
  choicesWrap.innerHTML = "";
  const buttons = [];

  if(state.mode === "strand"){
    STRANDS.forEach((s, i)=>{
      buttons.push({ label: s.label, key: s.key, hotkey: String(i+1), kind: "strand" });
    });
  } else if(state.mode === "keystage"){
    KEYSTAGES.forEach((k, i)=>{
      buttons.push({ label: k.label, key: k.key, hotkey: String(i+1), kind: "ks" });
    });
  } else {
    buttons.push(
      { label:"Pick Strand: CS",  key:"cs",  hotkey:"1", kind:"strand" },
      { label:"Pick Strand: ICT", key:"ict", hotkey:"2", kind:"strand" },
      { label:"Pick Strand: DL",  key:"dl",  hotkey:"3", kind:"strand" },
      { label:"Pick Key Stage: KS3", key:"ks3", hotkey:"4", kind:"ks" },
      { label:"Pick Key Stage: KS4", key:"ks4", hotkey:"5", kind:"ks" },
      { label:"Pick Key Stage: KS5", key:"ks5", hotkey:"6", kind:"ks" },
    );
  }

  buttons.forEach((b)=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.type = "button";
    btn.dataset.key = b.key;
    btn.dataset.kind = b.kind;
    btn.dataset.hotkey = b.hotkey;

    const leftTag = (b.kind === "strand") ? tagHTML("strand", b.key) : tagHTML("ks", b.key);

    btn.innerHTML = `
      ${leftTag}
      <span style="flex:1; font-weight:700;">${b.label}</span>
      <span class="kbd">${b.hotkey}</span>
    `;

    btn.addEventListener("click", ()=> onAnswer(b.kind, b.key));
    choicesWrap.appendChild(btn);
  });
}

function renderCard(){
  clearFeedback();
  state.locked = false;

  if(state.idx >= state.deck.length){
    promptText.textContent = "Round complete üéâ";
    promptMini.innerHTML = `
      You finished a short round. Reset for a fresh mix, or switch mode for variety.
      <br><br>
      <span class="tag cs"><strong>CS</strong></span>
      <span class="tag ict"><strong>ICT</strong></span>
      <span class="tag dl"><strong>DL</strong></span>
      <span class="tag ks3"><strong>KS3</strong></span>
      <span class="tag ks4"><strong>KS4</strong></span>
      <span class="tag ks5"><strong>KS5</strong></span>
    `;
    choicesWrap.innerHTML = `
      <button class="choice" type="button" id="playAgain" style="grid-column:1/-1; justify-content:center;">
        <span style="font-weight:800;">Play another short round</span>
      </button>
    `;
    el("playAgain").addEventListener("click", ()=> resetRound(true));
    confettiBurst(220);
    updateStats();
    return;
  }

  const card = state.deck[state.idx];
  promptText.textContent = card.topic;

  if(state.mode === "strand"){
    promptMini.textContent = "Pick the strand (CS / ICT / Digital Literacy).";
  } else if(state.mode === "keystage"){
    promptMini.textContent = "Pick the key stage where this is most emphasised.";
  } else {
    promptMini.textContent = "Boss: choose strand and key stage (order doesn‚Äôt matter).";
  }

  renderChoices(card);
  updateStats();
}

/* ===========================
   Boss mode sub-state
   =========================== */
let bossPicked = { strand:null, ks:null };

function resetBossPick(){
  bossPicked = { strand:null, ks:null };
}

function bossPickText(){
  const s = bossPicked.strand ? tagHTML("strand", bossPicked.strand) : `<span class="tag"><strong>Strand?</strong></span>`;
  const k = bossPicked.ks ? tagHTML("ks", bossPicked.ks) : `<span class="tag"><strong>Key Stage?</strong></span>`;
  return `Your picks: ${s} ${k}`;
}

/* ===========================
   Answer handling
   =========================== */
function onAnswer(kind, key){
  if(state.locked) return;

  const card = state.deck[state.idx];
  state.total++;

  if(state.mode === "strand"){
    checkSingle(kind, key, "strand", card.strand);
  } else if(state.mode === "keystage"){
    checkSingle(kind, key, "ks", card.ks);
  } else {
    if(kind === "strand") bossPicked.strand = key;
    if(kind === "ks") bossPicked.ks = key;

    setFeedback("good", `<span class="big">Boss picks updated</span><div class="small">${bossPickText()}</div>`);

    if(bossPicked.strand && bossPicked.ks){
      state.locked = true;
      const ok = (bossPicked.strand === card.strand) && (bossPicked.ks === card.ks);

      if(ok){
        state.correct++;
        state.score += 15;
        state.streak++;
        state.bestStreak = Math.max(state.bestStreak, state.streak);
        setFeedback("good",
          `<span class="big">Correct ‚úÖ</span>
           <div class="small">
             ${tagHTML("strand", card.strand)} ${tagHTML("ks", card.ks)}<br>
             ${card.why}
           </div>`
        );
        confettiBurst(90);
      } else {
        state.score = Math.max(0, state.score - 2);
        state.streak = 0;
        setFeedback("bad",
          `<span class="big">Not quite ‚ùå</span>
           <div class="small">
             Correct mapping: ${tagHTML("strand", card.strand)} ${tagHTML("ks", card.ks)}<br>
             ${card.why}
           </div>`
        );
      }

      updateStats();

      setTimeout(()=>{
        state.idx++;
        resetBossPick();
        renderCard();
      }, state.focus ? 450 : 900);
    }
  }
}

function checkSingle(kind, key, expectedKind, correctKey){
  if(kind !== expectedKind){
    setFeedback("bad", `<span class="big">Try the matching button set</span><div class="small">You clicked a ${kind === "strand" ? "strand" : "key stage"} choice in this mode.</div>`);
    updateStats();
    return;
  }

  state.locked = true;
  const card = state.deck[state.idx];

  const ok = (key === correctKey);
  if(ok){
    state.correct++;
    state.score += 10;
    state.streak++;
    state.bestStreak = Math.max(state.bestStreak, state.streak);

    setFeedback("good",
      `<span class="big">Correct ‚úÖ</span>
       <div class="small">
         ${state.mode === "strand" ? tagHTML("strand", card.strand) : tagHTML("ks", card.ks)}<br>
         ${card.why}
       </div>`
    );
    confettiBurst(60);
  } else {
    state.score = Math.max(0, state.score - 1);
    state.streak = 0;

    const correctTag = (state.mode === "strand")
      ? tagHTML("strand", card.strand)
      : tagHTML("ks", card.ks);

    setFeedback("bad",
      `<span class="big">Not quite ‚ùå</span>
       <div class="small">
         Correct answer: ${correctTag}<br>
         ${card.why}
       </div>`
    );
  }

  updateStats();

  setTimeout(()=>{
    state.idx++;
    renderCard();
  }, state.focus ? 400 : 850);
}

/* ===========================
   Controls
   =========================== */
btnNext.addEventListener("click", ()=>{
  if(state.idx >= state.deck.length) return;
  state.total++;
  state.streak = 0;
  setFeedback("bad", `<span class="big">Moved on</span><div class="small">No worries ‚Äî speed beats perfection here.</div>`);
  updateStats();
  setTimeout(()=>{
    state.idx++;
    if(state.mode === "both") resetBossPick();
    renderCard();
  }, state.focus ? 300 : 650);
});

btnSkip.addEventListener("click", ()=>{
  if(state.idx >= state.deck.length) return;
  state.total++;
  state.streak = 0;
  setFeedback("bad", `<span class="big">Skipped</span><div class="small">You can come back next round.</div>`);
  updateStats();
  setTimeout(()=>{
    state.idx++;
    if(state.mode === "both") resetBossPick();
    renderCard();
  }, state.focus ? 250 : 550);
});

btnReset.addEventListener("click", ()=> resetRound(true));

btnFocus.addEventListener("click", ()=>{
  state.focus = !state.focus;
  btnFocus.classList.toggle("good", state.focus);
  btnFocus.classList.toggle("primary", !state.focus);
  btnFocus.textContent = state.focus ? "Focus Mode: ON" : "Focus Mode";

  // Reduce on-screen noise in focus mode
  document.querySelector("aside").style.display = state.focus ? "none" : "block";

  // In focus mode, collapse the briefing by default (keeps it accessible via Show)
  if(state.focus && !briefingHidden){
    btnHideBrief.click();
  }
});

modes.forEach(b=>{
  b.addEventListener("click", ()=>{
    state.mode = b.dataset.mode;
    resetBossPick();
    renderMode();
  });
});

document.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){
    e.preventDefault();
    btnNext.click();
    return;
  }
  if(e.key.toLowerCase() === "s"){
    e.preventDefault();
    btnSkip.click();
    return;
  }

  const k = e.key;
  if(!/^[1-6]$/.test(k)) return;

  const btn = Array.from(document.querySelectorAll(".choice"))
    .find(x => x.dataset.hotkey === k);
  if(btn){
    btn.focus();
    btn.click();
  }
});

/* ===========================
   Reset / start
   =========================== */
function resetRound(keepScore){
  state.deck = buildDeck();
  state.idx = 0;
  state.locked = false;
  resetBossPick();

  if(!keepScore){
    state.score = 0;
    state.correct = 0;
    state.total = 0;
    state.streak = 0;
    state.bestStreak = 0;
  } else {
    state.streak = 0;
  }
  renderMode();
  updateStats();
}

/* ===========================
   Confetti FX (lightweight)
   =========================== */
const canvas = document.getElementById("fx");
const ctx = canvas.getContext("2d");
let particles = [];

function resize(){
  canvas.width = window.innerWidth * devicePixelRatio;
  canvas.height = window.innerHeight * devicePixelRatio;
  canvas.style.width = window.innerWidth + "px";
  canvas.style.height = window.innerHeight + "px";
}
window.addEventListener("resize", resize);
resize();

function confettiBurst(n=80){
  const reduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduce) return;

  const w = canvas.width, h = canvas.height;
  const cx = w * 0.5, cy = h * 0.18;
  for(let i=0;i<n;i++){
    particles.push({
      x: cx + (Math.random()*60-30) * devicePixelRatio,
      y: cy + (Math.random()*30-15) * devicePixelRatio,
      vx: (Math.random()*2-1) * 7 * devicePixelRatio,
      vy: (Math.random()*-1) * 10 * devicePixelRatio,
      g: 0.45 * devicePixelRatio,
      life: 90 + Math.random()*50,
      size: (2 + Math.random()*4) * devicePixelRatio,
      hue: Math.floor(Math.random()*360)
    });
  }
}

function tick(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles = particles.filter(p => p.life > 0);
  for(const p of particles){
    p.vy += p.g;
    p.x += p.vx;
    p.y += p.vy;
    p.life -= 1;

    ctx.save();
    ctx.globalAlpha = Math.max(0, Math.min(1, p.life/120));
    ctx.fillStyle = `hsl(${p.hue} 95% 60%)`;
    ctx.fillRect(p.x, p.y, p.size, p.size*0.7);
    ctx.restore();
  }
  requestAnimationFrame(tick);
}
tick();

// Start
resetRound(false);
</script>
</body>
</html>
